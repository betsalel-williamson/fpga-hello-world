---
inclusion: manual
---

# Design: FPGA Hello World on AWS Deployment

## 1. Objective

To define the technical approach for deploying a pre-built "Hello World" Amazon FPGA Image (AFI) to an AWS EC2 F1 instance, establishing a baseline for understanding cloud deployment workflows, resource utilization, and performance characteristics, with a strong emphasis on **FinOps principles** to manage monetary cost, deployment/execution time, and power consumption, all managed through a manually-triggered GitOps process, and incorporating **proactive budget guardrails**.

## 2. Technical Design

This design assumes a "Hello World" AFI has been successfully generated by a preceding CI process (e.g., `fpga-hello-world-github`). The focus here is on the cloud-specific aspects, guided by FinOps best practices:

-   **Infrastructure as Code (IaC):** AWS resources (EC2 F1 instance, S3 buckets for AFI storage, IAM roles/policies) will be defined using tools like AWS CloudFormation or Terraform. These IaC definitions will be version-controlled in a Git repository, enabling cost visibility and control.
-   **Manually Triggered CI/CD Deployment:** An automated pipeline (e.g., GitHub Actions) will be configured to allow for a manual trigger to provision/update the AWS infrastructure and deploy the host application. This manual gate is crucial for **cost governance** during development, preventing unnecessary spend.
-   **AWS EC2 F1 Instance:** The target platform for deploying the AFI and running the host application, provisioned and managed via IaC, with careful consideration for instance sizing to optimize cost-performance.
-   **Host Application:** A simple program (e.g., C/C++ or Python) running on the EC2 instance will interact with the FPGA to demonstrate the "Hello World" functionality. This application will be deployed as part of the CI/CD process.
-   **Monitoring & Cost Allocation:** Implementing mechanisms to capture monetary cost, deployment time, execution time, and estimated power consumption data, integrated into the automated workflow. This data is critical for **cost visibility, optimization, and chargeback/showback**.
-   **Budget Guardrails:** Proactively configuring AWS budget alerts and related mechanisms to provide early warnings and prevent cost overruns, ensuring financial control.
-   **Teardown Automation:** Scripts or IaC capabilities will be used to automate the de-provisioning of AWS resources to minimize costs, a key **FinOps practice for waste reduction**.

### 2.1. FinOps and Cost Considerations

Deploying and running FPGA workloads on AWS F1 instances can be expensive. Effective FinOps practices are essential to manage these costs. The primary cost drivers are:
*   **EC2 F1 Instance Uptime:** F1 instances are specialized and incur significant hourly charges. This is the largest area for potential cost overruns.
*   **AFI Generation:** While the build process itself is part of CI, the underlying AWS services used for AFI generation (e.g., S3 for intermediate files, potentially compute for synthesis if not done locally/in CI) can contribute to costs. Understanding these hidden costs is a FinOps concern.
*   **S3 Storage:** Storing AFIs and other build artifacts in S3 incurs storage costs, though typically minor compared to F1 instance uptime. Proper lifecycle policies are a FinOps optimization.

**FinOps Best Practices and Strategies to Minimize Costs:**
*   **Cost Visibility & Reporting:** Implement robust monitoring and reporting of AWS spend related to this project. This includes tagging resources appropriately for easier cost allocation and analysis.
*   **Manual Trigger for Deployment:** Deployment will *only* occur when explicitly triggered by a developer in the CI interface. This is a critical **governance gate** to prevent accidental or unnecessary deployments, directly impacting F1 instance uptime costs.
*   **Pre-Deployment Verification:** Thorough local simulation and CI build verification (including waveform analysis) must be completed *before* triggering an AWS deployment. This reduces the need for costly on-cloud debugging and iteration.
*   **Timely Teardown & Automation:** F1 instances and associated resources should be terminated or de-provisioned immediately after testing or verification is complete. Automated teardown scripts are crucial for **cost avoidance** and preventing idle resource charges.
*   **Resource Sizing & Optimization:** Use the smallest necessary F1 instance type for initial "Hello World" testing. Continuously evaluate resource utilization to right-size instances as the project evolves.
*   **AFI Lifecycle Management:** Implement policies to automatically delete old or unused AFIs from S3, optimizing storage costs.
*   **Budget Guardrails (AWS Budget Alerts):** Configure AWS budget alerts to notify stakeholders of potential cost overruns, enabling proactive intervention and ensuring financial control. This is a core component of our FinOps strategy.

### 2.2. Deployment Workflow (Manually Triggered via CI)

The deployment process will be integrated into the existing CI/CD pipeline but will require a manual approval/trigger step, aligning with FinOps governance.

1.  **Successful CI Build:** The automated CI pipeline completes successfully, generating the AFI and all necessary artifacts (e.g., host application binaries, IaC templates).
2.  **Manual Trigger in CI:** A developer reviews the CI build results (including simulation outputs and any pre-deployment checks). If confident, they manually trigger the "Deploy to AWS" stage within the CI interface (e.g., GitHub Actions workflow dispatch, Jenkins manual step). This acts as a **cost control checkpoint**.
3.  **IaC Provisioning/Update:** The CI pipeline, upon manual trigger, executes the Infrastructure as Code (IaC) templates (CloudFormation/Terraform) to:
    *   Provision a new EC2 F1 instance if one doesn't exist or update an existing one.
    *   Ensure the necessary S3 buckets are in place.
    *   Associate the newly generated AFI with the F1 instance.
4.  **Host Application Deployment:** The CI pipeline deploys the host application to the F1 instance.
5.  **Post-Deployment Configuration:** Any necessary runtime configuration or setup on the F1 instance is performed.

## 3. Verification of Deployment

After a manually triggered deployment:
*   **CI Logs:** Monitor CI logs for successful completion of all deployment steps.
*   **AWS Console:** Verify in the AWS EC2 console that the F1 instance is running, the correct AFI is loaded, and the host application is accessible/running.
*   **Host Application Output:** Execute the host application (if not automatically started) and observe its output to confirm interaction with the FPGA.
*   **Cost Monitoring:** Immediately verify that cost tracking mechanisms are active and reporting as expected, including checking for any budget alert notifications.

## 4. Teardown and Rollback

To manage costs and revert deployments, adhering to FinOps principles:
*   **Automated Teardown Script:** A dedicated script (e.g., `teardown-aws-resources.sh`) will be created to destroy the AWS infrastructure provisioned by IaC. This script should be easily executable locally or via a separate CI job, ensuring **cost avoidance**.
*   **Manual Teardown Trigger:** Developers will be responsible for manually triggering this teardown script/CI job once testing is complete, reinforcing **accountability for cloud spend**.
*   **IaC Rollback:** If a deployment fails or needs to be reverted, the IaC system (CloudFormation/Terraform) provides rollback capabilities to revert to a previous stable state. This should be understood and practiced to minimize prolonged erroneous resource usage.
*   **AFI De-registration:** AFIs can be de-registered from AWS to prevent accidental use and manage costs, though the primary cost is instance uptime.

## 5. Key Changes

### 5.1. API Contracts

N/A for this initial "Hello World" example, as the interaction will be primarily through low-level FPGA interfaces (e.g., AXI-Lite) exposed by the AFDK, rather than high-level APIs.

### 5.2. Data Models

N/A for this initial "Hello World" example.

### 5.3. Component Responsibilities

-   **IaC Definitions:** Defines and manages the AWS infrastructure required for deployment, with embedded cost tagging and optimization considerations.
-   **CI/CD Pipeline (Deployment Stage):** Automates the deployment and update processes based on a manual trigger, utilizing the pre-built AFI and host application, incorporating **FinOps governance gates**.
-   **AWS EC2 F1 Instance:** Provides the hardware platform for the FPGA and runs the host application, managed by IaC, with **right-sizing and cost-performance optimization**.
-   **Host Application:** Manages AFI loading, communicates with the FPGA, and reports results, deployed via CI/CD.
-   **Monitoring Scripts/Tools:** Collects and logs metrics related to cost, time, and power, integrated into the automated workflow for **cost visibility and allocation**.
-   **Budget Guardrail Configuration:** Responsible for setting up and maintaining AWS budget alerts and other proactive cost control mechanisms.
-   **Teardown Scripts:** Responsible for de-provisioning AWS resources, a key **FinOps practice for waste reduction**.

## 6. Alternatives Considered

-   **Fully Automated Deployment:** Rejected for initial development due to high potential costs. A manually triggered approach provides a necessary **FinOps governance gate**.
-   **Manual AWS Resource Provisioning (via Console):** Rejected in favor of IaC and CI-triggered deployment to ensure repeatability, version control, and to avoid manual errors, even with a manual trigger, aligning with **FinOps principles of automation and control**.

## 7. Out of Scope

-   FPGA HDL design and AFI build process (covered by `fpga-hello-world-github`).
-   Complex FPGA designs beyond "Hello World" functionality.
-   Optimization for performance or resource utilization beyond basic functionality.
-   Detailed power analysis requiring specialized hardware tools (estimation will be based on AWS metrics where available).
-   Integration with other AWS services beyond EC2 F1.

## 8. Open Questions / Future Work

-   Detailed specification of monitoring metrics and logging mechanisms, including **cost allocation tags**.
-   Refinement of automated teardown procedures and **scheduled cost-saving actions**.
-   Transition to fully automated deployment with **FinOps anomaly detection** (as budget guardrails are now in scope).