---
inclusion: manual
---
# Design: FPGA Hello World on AWS Deployment

## 1. Objective

This document defines the technical approach for deploying a pre-built "Hello World" Amazon FPGA Image (AFI) to an AWS EC2 F2 instance. It establishes a baseline for understanding cloud deployment workflows, resource utilization, and performance characteristics, with a strong emphasis on **FinOps principles** to manage monetary cost, deployment/execution time, and power consumption. The process is managed through a manually-triggered GitOps approach and incorporates **proactive budget guardrails**.

## 2. Technical Design

This design addresses the cloud-specific aspects of FPGA deployment, guided by FinOps best practices. A "Hello World" AFI is assumed to be successfully generated by a preceding CI process (e.g., `fpga-hello-world-github`).

The **AWS EC2 F2 FPGA Development Kit** is a hardware-software development kit. It supports development for FPGA cards on EC2 F2 instances. The kit includes:

* **Hardware Development Kit (HDK):** For RTL developers utilizing tools like Xilinx Vivado and other 3rd-party simulation tools.
* **Software Development Kit (SDK):** For runtime software development, offering Python/C/C++ APIs and CLIs for interacting with the FPGA.
* **Vitis:** Support for accelerating C/C++ applications.
* **Examples:** Includes resources such as the Streaming Data Engine (SDE) Library and Virtual Ethernet. [1, 5]

* **Infrastructure as Code (IaC):** AWS resources (EC2 F2 instance, S3 buckets for AFI storage, IAM roles/policies) are defined using tools like AWS CloudFormation or Terraform. These IaC definitions are version-controlled in a Git repository, enabling cost visibility and control.
* **Manually Triggered CI/CD Deployment:** An automated pipeline (e.g., GitHub Actions) is configured to allow for a manual trigger to provision/update the AWS infrastructure and deploy the host application. This manual gate provides **cost governance** during development, preventing unnecessary spend.
* **AWS EC2 F2 Instance:** The target platform for deploying the AFI and running the host application. It is provisioned and managed via IaC, with consideration for instance sizing to optimize cost-performance.
* **Host Application:** A simple program (e.g., C/C++ or Python) runs on the EC2 instance and interacts with the FPGA to demonstrate the "Hello World" functionality. This application is deployed as part of the CI/CD process.
* **Monitoring & Cost Allocation:** Mechanisms capture monetary cost, deployment time, execution time, and estimated power consumption data, integrated into the automated workflow. This data supports **cost visibility, optimization, and chargeback/showback**.
* **Budget Guardrails:** AWS budget alerts and related mechanisms are proactively configured to provide early warnings and prevent cost overruns, supporting financial control.
* **Teardown Automation:** Scripts or IaC capabilities automate the de-provisioning of AWS resources to minimize costs, a **FinOps practice for waste reduction**.

### 2.1. FinOps and Cost Considerations for Amazon EC2 F2 Instances

Amazon EC2 F2 Instances are powered by AMD Virtex UltraScale+ HBM VU47P FPGAs and feature 3rd generation AMD EPYC (Milan) processors [1, 3, 5]. Deploying and running FPGA workloads on AWS F2 instances can be expensive. FinOps practices manage these costs. The primary cost drivers are:

* **EC2 F2 Instance Uptime:** F2 instances are specialized and incur hourly charges. This is a primary area for potential cost overruns.
  * **F2 Instance Types and Approximate On-Demand Hourly Costs:** F2 instances are available in specific regions like US East (N. Virginia), Europe (London), and US West (Oregon) [3, 4, 9]. Common sizes and their approximate On-Demand hourly costs are:
    * `f2.6xlarge`: This instance type offers a lower-cost entry point for FPGA computing with 1 FPGA, 24 vCPUs, 256 GB of system memory, and 950 GB of NVMe SSD local storage [9].
    * `f2.12xlarge`: This instance type is available in regions like US East (N. Virginia) and generally starts at approximately $3.96 per hour [6, 10]. It features 48 vCPUs, 512 GiB of memory, and 2 FPGAs [6].
    * `f2.48xlarge`: This instance type is available in regions like US East (N. Virginia) and has a proportionally higher hourly cost, starting around $15.84 per hour [8]. It features 192 vCPUs, 2048 GiB of memory, and up to 8 FPGAs [1, 7, 8].
    * For the most precise and up-to-date pricing, consult the official AWS EC2 Pricing page for F2 instances in your chosen region. AWS prices are subject to change.
  * **Key Features of F2 Instances Relevant to Cost:**
    * Up to 8 AMD Virtex UltraScale+ HBM VU47P FPGAs per instance [1, 3, 5]: More FPGAs generally mean higher cost per hour, but also more parallel processing power.
    * High Bandwidth Memory (HBM): Each FPGA has 16 GiB of HBM and 64 GiB of DDR4 memory [1, 3, 5], which can accelerate workloads, potentially reducing the total time an instance needs to run.
    * Powerful CPU (192 vCPU AMD EPYC processor for `f2.48xlarge`) [1, 3, 5]: The instances come with substantial CPU resources, which might be beneficial for certain aspects of development flow but also contribute to the cost.
    * Price-Performance: AWS states up to 60% better price-performance than F1 instances [1], meaning more work can be achieved for the same or less cost, if managed effectively.
* **AFI Generation:** While the build process is part of CI, the underlying AWS services used for AFI generation (e.g., S3 for intermediate files, potentially compute for synthesis if not done locally/in CI) can contribute to costs. Understanding these hidden costs is a FinOps concern.
* **S3 Storage:** Storing AFIs and other build artifacts in S3 incurs storage costs, though typically minor compared to F2 instance uptime. Proper lifecycle policies are a FinOps optimization.

**FinOps Best Practices and Strategies to Minimize Costs (Enhanced Focus):**

* **Cost Visibility & Reporting:** Robust monitoring and reporting of AWS spend related to this project are implemented. This includes tagging resources appropriately for easier cost allocation and analysis.
* **Aggressive Stop/Start Automation:** This is a highly impactful cost-saving measure. F2 instances are stopped immediately when not actively in use. AWS Lambda with CloudWatch Events or the AWS Instance Scheduler are utilized to automatically stop instances during off-hours (evenings, weekends, holidays).
* **Pre-Deployment Verification:** Thorough local simulation and CI build verification (including waveform analysis) are completed *before* triggering an AWS deployment. This reduces the need for costly on-cloud debugging and iteration.
* **Timely Teardown & Automation:** F2 instances and associated resources are terminated or de-provisioned immediately after testing or verification is complete. Automated teardown scripts are crucial for **cost avoidance** and preventing idle resource charges.
* **Resource Sizing & Optimization:** The smallest necessary F2 instance type for initial "Hello World" testing is used [9]. Resource utilization is continuously evaluated to right-size instances as the project evolves.
* **AFI Lifecycle Management:** Policies are implemented to automatically delete old or unused AFIs from S3, optimizing storage costs.
* **Budget Guardrails (AWS Budget Alerts):** AWS budget alerts are configured to notify stakeholders of potential cost overruns, enabling proactive intervention and supporting financial control. This component supports the FinOps strategy. AWS Budgets can also be configured to take automated actions, such as stopping EC2 instances, when a threshold is exceeded.

### 2.2. Deployment Workflow (Manually Triggered via CI)

The deployment process is integrated into the existing CI/CD pipeline and requires a manual approval/trigger step, aligning with FinOps governance.

1. **Successful CI Build:** The automated CI pipeline completes successfully, generating the AFI and all necessary artifacts (e.g., host application binaries, IaC templates).
2. **Manual Trigger in CI:** A developer reviews the CI build results (including simulation outputs and any pre-deployment checks). If confident, they manually trigger the "Deploy to AWS" stage within the CI interface (e.g., GitHub Actions workflow dispatch, Jenkins manual step). This acts as a **cost control checkpoint**.
3. **IaC Provisioning/Update:** The CI pipeline, upon manual trigger, executes the Infrastructure as Code (IaC) templates (CloudFormation/Terraform) to:
    * Provision a new EC2 F2 instance if one does not exist or update an existing one.
    * Ensure the necessary S3 buckets are in place.
    * Associate the newly generated AFI with the F2 instance.
4. **Host Application Deployment:** The CI pipeline deploys the host application to the F2 instance.
5. **Post-Deployment Configuration:** Any necessary runtime configuration or setup on the F2 instance is performed.

## 3. Verification of Deployment

After a manually triggered deployment:

* **CI Logs:** CI logs are monitored for successful completion of all deployment steps.
* **AWS Console:** Verification in the AWS EC2 console confirms that the F2 instance is running, the correct AFI is loaded, and the host application is accessible/running.
* **Host Application Output:** The host application is executed (if not automatically started) and its output observed to confirm interaction with the FPGA.
* **Cost Monitoring:** Cost tracking mechanisms are immediately verified to be active and reporting as expected, including checking for any budget alert notifications.

## 4. Teardown and Rollback

To manage costs and revert deployments, adherence to FinOps principles is maintained:

* **Automated Teardown Script:** A dedicated script (e.g., `teardown-aws-resources.sh`) is created to destroy the AWS infrastructure provisioned by IaC. This script is easily executable locally or via a separate CI job, ensuring **cost avoidance**.
* **Manual Teardown Trigger:** Developers are responsible for manually triggering this teardown script/CI job once testing is complete, supporting **accountability for cloud spend**.
* **IaC Rollback:** If a deployment fails or needs to be reverted, the IaC system (CloudFormation/Terraform) provides rollback capabilities to revert to a previous stable state. Understanding and practicing this minimizes prolonged erroneous resource usage.
* **AFI De-registration:** AFIs can be de-registered from AWS to prevent accidental use and manage costs, though the primary cost is instance uptime.

## 5. Key Changes

### 5.1. API Contracts

N/A for this initial "Hello World" example, as interaction is primarily through low-level FPGA interfaces (e.g., AXI-Lite) exposed by the AFDK, rather than high-level APIs.

### 5.2. Data Models

N/A for this initial "Hello World" example.

### 5.3. Component Responsibilities

* **IaC Definitions:** Defines and manages the AWS infrastructure required for deployment, with embedded cost tagging and optimization considerations.
* **CI/CD Pipeline (Deployment Stage):** Automates the deployment and update processes based on a manual trigger, utilizing the pre-built AFI and host application, incorporating **FinOps governance gates**.
* **AWS EC2 F2 Instance:** Provides the hardware platform for the FPGA and runs the host application. It is managed by IaC, with **right-sizing and cost-performance optimization**.
* **Host Application:** Manages AFI loading, communicates with the FPGA, and reports results. It is deployed via CI/CD.
* **Monitoring Scripts/Tools:** Collects and logs metrics related to cost, time, and power. It is integrated into the automated workflow for **cost visibility and allocation**.
* **Budget Guardrail Configuration:** Responsible for setting up and maintaining AWS budget alerts and other proactive cost control mechanisms.
* **Teardown Scripts:** Responsible for de-provisioning AWS resources, a **FinOps practice for waste reduction**.

## 6. Alternatives Considered

* **Fully Automated Deployment:** Rejected for initial development due to high potential costs. A manually triggered approach provides a necessary **FinOps governance gate**.
* **Manual AWS Resource Provisioning (via Console):** Rejected in favor of IaC and CI-triggered deployment to ensure repeatability, version control, and to avoid manual errors, even with a manual trigger. This aligns with **FinOps principles of automation and control**.

## 7. Out of Scope

* FPGA HDL design and AFI build process (covered by `fpga-hello-world-github`).
* Complex FPGA designs beyond "Hello World" functionality.
* Optimization for performance or resource utilization beyond basic functionality.
* Detailed power analysis requiring specialized hardware tools (estimation is based on AWS metrics where available).
* Integration with other AWS services beyond EC2 F2.

## 8. Open Questions / Future Work

* Detailed specification of monitoring metrics and logging mechanisms, including **cost allocation tags**.
* Refinement of automated teardown procedures and **scheduled cost-saving actions**.
* Transition to fully automated deployment with **FinOps anomaly detection** (as budget guardrails are now in scope).

## References

[1] Amazon EC2 F2 Instances. AWS. Retrieved from [https://aws.amazon.com/ec2/instance-types/f2/](https://aws.amazon.com/ec2/instance-types/f2/)
[2] Second Generation FPGA-Powered Amazon EC2 Instances (F2). CloudThat. (2025, February 24). Retrieved from [https://www.cloudthat.com/blog/second-generation-fpga-powered-amazon-ec2-instances-f2/](https://www.cloudthat.com/blog/second-generation-fpga-powered-amazon-ec2-instances-f2/)
[3] Now Available – Second-Generation FPGA-Powered Amazon EC2 instances (F2). AWS. (2024, December 11). Retrieved from [https://aws.amazon.com/blogs/aws/now-available-second-generation-fpga-powered-amazon-ec2-instances-f2/](https://aws.amazon.com/blogs/aws/now-available-second-generation-fpga-powered-amazon-ec2-instances-f2/)
[4] Amazon EC2 F2 instances, featuring up to 8 FPGAs, are generally available. Retrieved from [https://aws.amazon.com/blogs/aws/amazon-ec2-f2-instances-featuring-up-to-8-fpgas-are-generally-available/](https://aws.amazon.com/blogs/aws/amazon-ec2-f2-instances-featuring-up-to-8-fpgas-are-generally-available/)
[5] AWS EC2 FPGA Development Kit User Guide. Retrieved from [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-f2-instances.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-f2-instances.html)
[6] f2.12xlarge pricing and specs - Amazon EC2 Instance Comparison. Vantage. Retrieved from [https://www.vantage.sh/aws/ec2/f2.12xlarge](https://www.vantage.sh/aws/ec2/f2.12xlarge)
[7] Amazon EC2 Instance Type f2.48xlarge. Retrieved from [https://aws.amazon.com/ec2/instance-types/f2/f2.48xlarge/](https://aws.amazon.com/ec2/instance-types/f2/f2.48xlarge/)
[8] f2.48xlarge pricing and specs - Amazon EC2 Instance Comparison. Vantage. Retrieved from [https://www.vantage.sh/aws/ec2/f2.48xlarge](https://www.vantage.sh/aws/ec2/f2.48xlarge)
[9] Announcing the general availability of Amazon EC2 F2.6xlarge, a new F2 instance size. AWS. (2025, February 5). Retrieved from [https://aws.amazon.com/blogs/aws/announcing-the-general-availability-of-amazon-ec2-f2-6xlarge-a-new-f2-instance-size/](https://aws.amazon.com/blogs/aws/announcing-the-general-availability-of-amazon-ec2-f2-6xlarge-a-new-f2-instance-size/)
[10] EC2 Instance Types & Pricing. Retrieved from [https://instances.vantage.sh/](https://instances.vantage.sh/)
[11] AWS EC2 F1 instance is no longer supported for new users - Google Groups. (2025, April 7). Retrieved from [https://groups.google.com/g/chipyard/c/6w-4w-2W0zQ/m/x_0X_0W0zQ](https://groups.google.com/g/chipyard/c/6w-4w-2W0zQ/m/x_0X_0W0zQ)
[12] What happened to AWS F1 : r/FPGA - Reddit. (2025, March 25). Retrieved from [https://www.reddit.com/r/FPGA/comments/1cmq1qj/what_happened_to_aws_f1/](https://www.reddit.com/r/FPGA/comments/1cmq1qj/what_happened_to_aws_f1/)
[13] FPGA Developer AMI Updates - AWS re:Post. (2024, November 4). Retrieved from [https://repost.aws/questions/QUq7R0qLd0Q/fpga-developer-ami-updates](https://repost.aws/questions/QUq7R0qLd0Q/fpga-developer-ami-updates)
[14] Who is using ec2 f1 instances? : r/aws - Reddit. (2024, February 13). Retrieved from [https://www.reddit.com/r/aws/comments/1aps0j2/who_is_using_ec2_f1_instances/](https://www.reddit.com/r/aws/comments/1aps0j2/who_is_using_ec2_f1_instances/)
[15] Amazon EC2 F1 Instances. awsstatic.com. Retrieved from [https://d1.awsstatic.com/products/EC2/f1-instances_overview.pdf](https://d1.awsstatic.com/products/EC2/f1-instances_overview.pdf)

<https://awsdocs-fpga-f2.readthedocs-hosted.com/>

<https://aws.amazon.com/ec2/instance-types/f2/>
